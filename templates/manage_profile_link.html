{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
        <h2 class="text-2xl font-bold text-dark mb-2">Your Profile Links</h2>
        <p class="text-gray-600 mb-6">Share these links to increase your visibility</p>
        
        <!-- Profile URLs -->
        <div class="space-y-4">
            <div class="border border-gray-200 rounded-lg p-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Clean URL (Recommended)</label>
                <div class="flex items-center space-x-2">
                    <input type="text" 
                           value="{{ profile_urls.clean_url }}" 
                           id="cleanUrl" 
                           readonly 
                           class="flex-grow px-4 py-2 rounded-lg border border-gray-300 bg-gray-50">
                    <button onclick="copyToClipboard('cleanUrl')" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                        Copy
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-2">Example: clearq.com/{{ current_user.username }}</p>
            </div>
            
            <div class="border border-gray-200 rounded-lg p-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Short URL</label>
                <div class="flex items-center space-x-2">
                    <input type="text" 
                           value="{{ profile_urls.short_url }}" 
                           id="shortUrl" 
                           readonly 
                           class="flex-grow px-4 py-2 rounded-lg border border-gray-300 bg-gray-50">
                    <button onclick="copyToClipboard('shortUrl')" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                        Copy
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-2">Example: clearq.com/@{{ current_user.username }}</p>
            </div>
            
            <div class="border border-gray-200 rounded-lg p-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">ID-based URL</label>
                <div class="flex items-center space-x-2">
                    <input type="text" 
                           value="{{ profile_urls.id_url }}" 
                           id="idUrl" 
                           readonly 
                           class="flex-grow px-4 py-2 rounded-lg border border-gray-300 bg-gray-50">
                    <button onclick="copyToClipboard('idUrl')" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                        Copy
                    </button>
                </div>
                <p class="text-sm text-gray-500 mt-2">Legacy format for backward compatibility</p>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
            <div class="bg-blue-50 rounded-lg p-6 text-center">
                <div class="text-3xl font-bold text-primary">{{ mentor.profile_views or 0 }}</div>
                <div class="text-gray-600">Profile Views</div>
            </div>
            <div class="bg-green-50 rounded-lg p-6 text-center">
                <div class="text-3xl font-bold text-green-600">{{ mentor.link_clicks or 0 }}</div>
                <div class="text-gray-600">Link Clicks</div>
            </div>
            <div class="bg-purple-50 rounded-lg p-6 text-center">
                <div class="text-3xl font-bold text-purple-600">{{ bookings|length }}</div>
                <div class="text-gray-600">Total Bookings</div>
            </div>
        </div>
    </div>
    
    <!-- Recent Bookings -->
    <div class="bg-white rounded-2xl shadow-lg p-8">
        <h3 class="text-xl font-bold text-dark mb-6">Recent Booking Requests</h3>
        
        {% if bookings %}
        <div class="space-y-4">
            {% for booking in bookings %}
            <div class="border border-gray-200 rounded-lg p-4">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-semibold text-gray-900">{{ booking.service_name }}</h4>
                        <p class="text-sm text-gray-600">{{ booking.booking_date }} â€¢ {{ booking.booking_time }}</p>
                        <p class="text-sm text-gray-600">Duration: {{ booking.duration }} minutes</p>
                        {% if booking.learner %}
                        <p class="text-sm text-gray-600">From: {{ booking.learner.username }}</p>
                        {% endif %}
                    </div>
                    <div>
                        <span class="px-3 py-1 rounded-full text-sm font-medium
                            {% if booking.status == 'Paid' %} bg-green-100 text-green-800
                            {% elif booking.status == 'Pending' %} bg-yellow-100 text-yellow-800
                            {% else %} bg-gray-100 text-gray-800
                            {% endif %}">
                            {{ booking.status }}
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-8">
            <i class="fas fa-calendar text-gray-300 text-4xl mb-4"></i>
            <p class="text-gray-500">No booking requests yet</p>
            <p class="text-sm text-gray-400 mt-2">Share your profile link to get more visibility</p>
        </div>
        {% endif %}
    </div>
    
    <!-- Share Section -->
    <div class="mt-8 bg-gradient-to-r from-primary to-secondary rounded-2xl p-8 text-white">
        <h3 class="text-xl font-bold mb-4">Share Your Profile</h3>
        <p class="mb-6">Increase your visibility by sharing your profile on social media</p>
        <div class="flex space-x-4">
            <button onclick="shareOnLinkedIn()" 
                    class="flex-1 bg-white text-primary py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors">
                <i class="fab fa-linkedin mr-2"></i> LinkedIn
            </button>
            <button onclick="shareOnTwitter()" 
                    class="flex-1 bg-white text-primary py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors">
                <i class="fab fa-twitter mr-2"></i> Twitter
            </button>
            <button onclick="shareByEmail()" 
                    class="flex-1 bg-white text-primary py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors">
                <i class="fas fa-envelope mr-2"></i> Email
            </button>
        </div>
    </div>
</div>

<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    element.setSelectionRange(0, 99999); // For mobile devices
    navigator.clipboard.writeText(element.value).then(() => {
        // Show success message
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('bg-green-500', 'hover:bg-green-600');
        button.classList.remove('bg-primary', 'hover:bg-primary-dark');
        
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-green-500', 'hover:bg-green-600');
            button.classList.add('bg-primary', 'hover:bg-primary-dark');
        }, 2000);
    });
}

function shareOnLinkedIn() {
    const url = encodeURIComponent("{{ profile_urls.clean_url }}");
    const title = encodeURIComponent("Check out my mentor profile on ClearQ");
    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&title=${title}`, '_blank');
}

function shareOnTwitter() {
    const url = encodeURIComponent("{{ profile_urls.clean_url }}");
    const text = encodeURIComponent(`I'm available for mentorship on ClearQ! Check out my profile: `);
    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
}

function shareByEmail() {
    const subject = encodeURIComponent("My Mentor Profile on ClearQ");
    const body = encodeURIComponent(`Hi,\n\nI'm available for mentorship on ClearQ. You can view my profile here:\n{{ profile_urls.clean_url }}\n\nBest regards,\n{{ current_user.full_name or current_user.username }}`);
    window.location.href = `mailto:?subject=${subject}&body=${body}`;
}

// QR Code generation (optional)
function generateQRCode() {
    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data={{ profile_urls.clean_url }}`;
    // You can display this in a modal or new window
    window.open(qrCodeUrl, '_blank');
}
</script>
{% endblock %}
